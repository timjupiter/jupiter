<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase - Chat</title>
    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyAwF9zniA7CBfEk0-EBnC7qTIveB1AQmYM",
            authDomain: "jupiter-1b026.firebaseapp.com",
            databaseURL: "https://console.firebase.google.com/project/jupiter-1b026/database/jupiter-1b026-default-rtdb/data/~2F",
            projectId: "jupiter-1b026",
            storageBucket: "jupiter-1b026.appspot.com",
            messagingSenderId: "504918793683",
            appId: "1:504918793683:web:bcc77e0a2c8a8e27d0e326",
            measurementId: "G-4SMG7QG8D0"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Fungsi untuk mengirim pesan ke Firebase
        function sendMessage() {
            const message = document.getElementById("message").value;
            const userName = document.getElementById("userName").value;

            if (message.trim() !== "") {
                push(ref(database, 'chat/'), {
                    username: userName,
                    message: message,
                    timestamp: new Date().toISOString()
                })
                .then(() => {
                    document.getElementById("message").value = ""; // Clear input
                })
                .catch((error) => {
                    console.error("Error sending message:", error);
                });
            } else {
                console.log("Pesan kosong, tidak dikirim.");
            }
        }

        // Fungsi untuk menampilkan pesan secara real-time
        function displayMessages(snapshot) {
            const messages = snapshot.val();
            const chatBox = document.getElementById("chatBox");
            chatBox.innerHTML = ''; // Kosongkan chat box sebelum menambahkan pesan baru

            for (let key in messages) {
                const message = messages[key];
                const messageElement = document.createElement("div");
                messageElement.textContent = `${message.username}: ${message.message}`;
                chatBox.appendChild(messageElement);
            }
        }

        // Mengambil dan menampilkan pesan secara real-time
        const chatRef = ref(database, 'chat/');
        onValue(chatRef, displayMessages);
    </script>
</head>
<body>
    <h1>Chat with Firebase Realtime Database</h1>
    <input type="text" id="userName" placeholder="Your Name" />
    <input type="text" id="message" placeholder="Type a message..." />
    <button onclick="sendMessage()">Kirim Pesan</button>

    <div id="chatBox" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto;"></div>
</body>
</html>
